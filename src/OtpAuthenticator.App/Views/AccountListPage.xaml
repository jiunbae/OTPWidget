<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="OtpAuthenticator.App.Views.AccountListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:OtpAuthenticator.App.Views"
    xmlns:vm="using:OtpAuthenticator.App.ViewModels">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Text="Accounts"
                       Style="{StaticResource TitleTextBlockStyle}" />

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                <Button x:Name="ScanQrButton" ToolTipService.ToolTip="Scan QR Code">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B0;" FontSize="16" />
                        <TextBlock Text="Scan QR" />
                    </StackPanel>
                </Button>

                <Button x:Name="AddButton" Style="{StaticResource AccentButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;" FontSize="16" />
                        <TextBlock Text="Add Account" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Empty State -->
        <StackPanel x:Name="EmptyState"
                    Grid.Row="1"
                    Visibility="Collapsed"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="16">
            <FontIcon Glyph="&#xE8D7;" FontSize="64" Opacity="0.5" />
            <TextBlock Text="No accounts yet"
                       Style="{StaticResource SubtitleTextBlockStyle}"
                       Opacity="0.7" />
            <TextBlock Text="Add your first account by scanning a QR code or entering manually"
                       TextWrapping="Wrap"
                       TextAlignment="Center"
                       MaxWidth="300"
                       Opacity="0.5" />
            <Button Content="Add Account"
                    Style="{StaticResource AccentButtonStyle}"
                    Margin="0,16,0,0"
                    Click="OnAddButtonClick" />
        </StackPanel>

        <!-- Account List -->
        <ListView x:Name="AccountListView"
                  Grid.Row="1"
                  SelectionMode="None"
                  ItemsSource="{x:Bind ViewModel.Accounts, Mode=OneWay}">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="vm:AccountItemViewModel">
                    <Border Style="{StaticResource AccountCardStyle}"
                            Margin="0,0,0,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Icon -->
                            <Border Grid.Column="0"
                                    Style="{StaticResource IconCircleStyle}"
                                    Margin="0,0,16,0">
                                <TextBlock Text="{x:Bind Initial}"
                                           FontSize="20"
                                           FontWeight="SemiBold"
                                           Foreground="White"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Border>

                            <!-- Account Info -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{x:Bind Issuer}"
                                           Style="{StaticResource IssuerTextStyle}" />
                                <TextBlock Text="{x:Bind AccountName}"
                                           Style="{StaticResource AccountNameTextStyle}" />
                            </StackPanel>

                            <!-- OTP Code -->
                            <StackPanel Grid.Column="2"
                                        VerticalAlignment="Center"
                                        Margin="16,0">
                                <TextBlock Text="{x:Bind FormattedCode, Mode=OneWay}"
                                           Style="{StaticResource OtpCodeTextStyle}" />
                                <ProgressBar Value="{x:Bind Progress, Mode=OneWay}"
                                             Maximum="1"
                                             Height="4"
                                             Margin="0,4,0,0" />
                            </StackPanel>

                            <!-- Actions -->
                            <StackPanel Grid.Column="3"
                                        Orientation="Horizontal"
                                        Spacing="4">
                                <Button Command="{x:Bind CopyCodeCommand}"
                                        ToolTipService.ToolTip="Copy code">
                                    <FontIcon Glyph="{x:Bind IsCopied, Mode=OneWay, Converter={StaticResource CopyIconConverter}}"
                                              FontSize="16" />
                                </Button>
                                <Button ToolTipService.ToolTip="More options">
                                    <FontIcon Glyph="&#xE712;" FontSize="16" />
                                    <Button.Flyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem Text="Edit" Icon="Edit" />
                                            <MenuFlyoutItem Text="Favorite" Icon="Favorite" />
                                            <MenuFlyoutSeparator />
                                            <MenuFlyoutItem Text="Delete" Icon="Delete" />
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Loading -->
        <ProgressRing x:Name="LoadingRing"
                      Grid.Row="1"
                      IsActive="False"
                      Width="48"
                      Height="48"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center" />
    </Grid>
</Page>
